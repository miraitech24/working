この仕様書は、現場のミクロなデータ（スキャン）を、経営のマクロな判断（利益計算）へ繋げるパイプラインを定義したものです。

---

# 業務詳細仕様書：飼料生産最適化パイプライン

**プロジェクト名：** ドローン検量・季節変動モデル統合システム

## 1. システム概要

本システムは、ドローンでスキャンした堆積物（大豆等の飼料原料）のボリュームデータと、数理モデル（Maxima）による利益最適化、およびシミュレーション用3Dモデル（STL）生成を統合するものである。

## 2. 工程定義（ワークフロー）

### 工程 ①：ドローン3Dスキャン（現場計測）

- **目的**: 屋外・倉庫内の飼料原料（バルク）の現存量を正確に把握する。

- **手法**: ドローンによる自動航行および写真測量（SfM）。

- **出力**: 点群データ（Point Cloud）およびメッシュデータ。

- **役割**: 現場の「リアルな制約条件（現在の在庫量 $b$）」を抽出する。

### 工程 ②：数理モデル構築と最適化（Maxima）

- **目的**: 季節ごとの原料特性（水分量、比重、単価）に基づき、最大利益となる生産計画を導出する。

- **入力**: ドローン計測値、市場価格、季節パラメータ（春・秋モデル）。

- **処理**: 線形計画法による利益最大化問題の解決。

- **出力**: 最適生産量および係数データの構造化（JSON形式）。

### 工程 ③：データ連携（JSONインターフェース）

- **目的**: 数学的な計算結果を、可視化・シミュレーション環境（Python）へ安全に引き渡す。

- **仕様**: `fname` 変数による動的なファイル管理。

- **主要キー**: `c`（利益係数）、`A_ub`（制約行列）、`b_ub`（在庫上限）、`bounds`（変域）。

### 工程 ④：シミュレーションモデル生成（Python / numpy-stl）

- **目的**: 計算結果を3D形状（STL）として可視化し、物流や保管効率の検討に供する。

- **処理**: JSONからパラメータを読み込み、`numpy-stl` を用いてボリュームモデルを生成。

- **出力**: `.stl` ファイル（春モデル、秋モデル等のバリエーション）。

---

## 3. 技術仕様（実装詳細）

### データ構造定義 (JSON)

JSON

```
{
  "parameters": {
    "c": [-50, -80],
    "A_ub": [[2, 3], [1, 4]],
    "b_ub": [100, 80],
    "bounds": [[0, null], [0, null]]
  }
}
```

### 実行環境

- **計算エンジン**: Maxima 5.4x 以上

- **言語環境**: Python 3.8+ (Required: `numpy`, `scipy`, `numpy-stl`)

- **実行コマンド例**:
  
  Bash
  
  ```
  maxima --batch-string="fname:\"spring_soy.json\"; load(\"model_script.mac\");"
  python3 Fodder1.py spring_soy.json
  ```

---

## 4. 運用シナリオ：大豆モデルのケーススタディ

大豆のように「個体は小さいが総体として巨大な体積」を持つ原料は、以下の2軸で管理する。

| **項目**        | **春モデル（乾燥期）**   | **秋モデル（収穫・高湿期）**   |
| ------------- | --------------- | ------------------ |
| **原料特性**      | 低水分・高比重（締まっている） | 高水分・低比重（嵩張る）       |
| **3Dスキャンの焦点** | 在庫の「重さ」の推定      | 在庫の「腐敗・カビ」リスクの体積評価 |
| **STL出力の意義**  | 輸送コンテナの積載効率     | 倉庫内の通風・乾燥シミュレーション  |

---

## 5. 今後の拡張性

- **リアルタイム連携**: ドローンからアップロードされた点群データから直接 `b_ub`（在庫制限）を自動計算し、Maximaへ流し込む機能。

- **乾燥シミュレーション**: 生成したSTLモデルに対し、表面積と体積の比率（S/V比）から乾燥速度を計算する熱流体解析との連携。

---

作成日: 2026年1月2日

担当: 
